chatbot.py - библиотека для разработки чатботов (сейчас это только телеграмм, но задумка была сделать общую библиотеку для всех мессенджеров)
# Архитектура бота
Взаимодействие с ботом построено на создании "обработчиков", регистрируемых в боте с помощью декоратора. Кроме того, бот позволяет направить сообщение пользователю немедленно или с отсрочкой по времени. 

Обработчики деляться на несколько типов
- обработчик ответа (когда пользователь что-то написал боту вызывется этот обработчик)
- обработчик ожидания (когда бот написал пользователю и ждет от него ответа, у него есть таймаут (после которого вызывается обработчки ожидания)). 

Для хранения состояний, отложенных сообщений и информации о пользователях используется база данных на mongo.

# Классы
- Bot - основной класс
- SessionStore - хранилище данных. Используется чтобы скрыть реализацию взаимодействия с БД на случай замены движка
- MessageHandler - обработчик ответа. создается с помощью декоратора или используя метод бота register_message_handler
- EventHandler - обработчик ожадния. создается с помощью декоратора или используя метод бота register_event_handler
- Message - сообщение от пользователя. помимо данных из сообщения он обогощается связью с пользователем
- User - пользователь. к пользователю привязывается контекст и данные

## Bot
- __init__() - конструктор объекта
    - token - токен бота
    - session_store = None - хранилище данных, если не передается создается собственное
    - threads = 0 - количество потоков для работы. Если 0 бот работает без потоков
    - proxy = [] - настройки прокси для работы на территории РФ :)
    - skip_pending = True - игнорировать пропущенные сообщения
- send_message() - отправить сообщение пользователю
    - chat_id - идентификатор пользователя (чата)
    - message - текст сообщения
    - new_stage=None
    - stage_ttl=None 
    - disable_web_page_preview=None, 
    - reply_to_message_id=None, 
    - reply_markup=None,
    - parse_mode=None,
    - disable_notification=None, 
    - timeout=None
- run() - запустить бота
- stop() - остановить бота
@bot.on_message(filters)=>stop - обработчик сообщения от пользователя
    def do_something(bot, message, session)    
@bot.on_fire(filters)=>stop - обработчик ожидания
    def do_something(bot, fire_count, session)    

filters:
- commands
- stages
- regexp
- func
- content_type

## Bot_Session_Store
- __init__()
- get_locals_by_id()=>Dict
    - id
- set_locals_by_id()
    - id
    - locals=None
- set_new_stage()
    - id
    - new_stage
    - time_to_expire=0
- drop_stage()
    - id
- get_chats_with_expired_stages()=>[]
    - id
- get_pending_messages()=>[message]
    - id
